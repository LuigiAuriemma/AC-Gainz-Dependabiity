


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > ProdottoDAO</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">model</a>
</div>

<h1>Coverage Summary for Class: ProdottoDAO (model)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ProdottoDAO</td>
<td class="coverageStat">
  <span class="percent">
    9,1%
  </span>
  <span class="absValue">
    (1/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/38)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0,6%
  </span>
  <span class="absValue">
    (1/161)
  </span>
</td>
</tr>
  <tr>
    <td class="name">ProdottoDAO$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    7,7%
  </span>
  <span class="absValue">
    (1/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/42)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0,6%
  </span>
  <span class="absValue">
    (1/168)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package model;
&nbsp;
&nbsp;import java.sql.*;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Comparator;
&nbsp;import java.util.List;
&nbsp;import java.util.Objects;
&nbsp;
<b class="fc">&nbsp;public class ProdottoDAO {</b>
&nbsp;
&nbsp;    public Prodotto doRetrieveById(String id)
&nbsp;    {
<b class="nc">&nbsp;        try(Connection con= ConPool.getConnection())</b>
&nbsp;        {
<b class="nc">&nbsp;            PreparedStatement preparedStatement=con.prepareStatement(&quot;SELECT * FROM prodotto WHERE prodotto.id_prodotto = ?&quot;);</b>
<b class="nc">&nbsp;            preparedStatement.setString(1,id);</b>
&nbsp;
<b class="nc">&nbsp;            ResultSet resultSet=preparedStatement.executeQuery();</b>
<b class="nc">&nbsp;            List&lt;Variante&gt; varianti = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            if(resultSet.next()) {</b>
<b class="nc">&nbsp;                Prodotto p = new Prodotto();</b>
&nbsp;
<b class="nc">&nbsp;                p.setIdProdotto(resultSet.getString(&quot;id_prodotto&quot;));</b>
<b class="nc">&nbsp;                p.setNome(resultSet.getString(&quot;nome&quot;));</b>
<b class="nc">&nbsp;                p.setDescrizione(resultSet.getString(&quot;descrizione&quot;));</b>
<b class="nc">&nbsp;                p.setCategoria(resultSet.getString(&quot;categoria&quot;));</b>
<b class="nc">&nbsp;                p.setImmagine(resultSet.getString(&quot;immagine&quot;));</b>
<b class="nc">&nbsp;                p.setCalorie(resultSet.getInt(&quot;calorie&quot;));</b>
<b class="nc">&nbsp;                p.setCarboidrati(resultSet.getInt(&quot;carboidrati&quot;));</b>
<b class="nc">&nbsp;                p.setProteine(resultSet.getInt(&quot;proteine&quot;));</b>
<b class="nc">&nbsp;                p.setGrassi(resultSet.getInt(&quot;grassi&quot;));</b>
&nbsp;
<b class="nc">&nbsp;                VarianteDAO varianteDAO = new VarianteDAO();</b>
<b class="nc">&nbsp;                varianti = varianteDAO.doRetrieveVariantiByIdProdotto(p.getIdProdotto());</b>
&nbsp;
<b class="nc">&nbsp;                p.setVarianti(varianti);</b>
&nbsp;
<b class="nc">&nbsp;                return p;</b>
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;
&nbsp;        }
&nbsp;        catch (SQLException sqlException)
&nbsp;        {
<b class="nc">&nbsp;            throw new RuntimeException(sqlException);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    public List&lt;Prodotto&gt; filterProducts(String category, String sortingFilter, String weightFilter, String tasteFilter, String nameFilter) throws SQLException {
<b class="nc">&nbsp;        List&lt;Prodotto&gt; filteredProducts = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        VarianteDAO varianteDAO = new VarianteDAO();</b>
&nbsp;        boolean filterOnEvidence;
&nbsp;
&nbsp;
<b class="nc">&nbsp;        System.out.println(&quot;nameFilterDAO: &quot; + nameFilter);</b>
&nbsp;
<b class="nc">&nbsp;        try (Connection connection = ConPool.getConnection()) {</b>
<b class="nc">&nbsp;            StringBuilder sql = new StringBuilder();</b>
<b class="nc">&nbsp;            sql.append(&quot;SELECT p.* FROM prodotto p &quot;);</b>
&nbsp;
&nbsp;            // Gestione delle condizioni di filtraggio
<b class="nc">&nbsp;            List&lt;String&gt; conditions = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            List&lt;Object&gt; params = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;            if (category != null &amp;&amp; !category.equals(&quot;tutto&quot;) &amp;&amp; !category.isBlank()) {</b>
<b class="nc">&nbsp;                conditions.add(&quot;p.categoria = ?&quot;);</b>
<b class="nc">&nbsp;                params.add(category);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (nameFilter != null &amp;&amp; !nameFilter.isBlank()) {</b>
<b class="nc">&nbsp;                conditions.add(&quot;p.nome LIKE ?&quot;);</b>
<b class="nc">&nbsp;                params.add(&quot;%&quot; + nameFilter + &quot;%&quot;);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (!conditions.isEmpty()) {</b>
<b class="nc">&nbsp;                sql.append(&quot;WHERE &quot;);</b>
<b class="nc">&nbsp;                sql.append(String.join(&quot; AND &quot;, conditions));</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            System.out.println(sql.toString());</b>
&nbsp;
<b class="nc">&nbsp;            PreparedStatement preparedStatement = connection.prepareStatement(sql.toString());</b>
&nbsp;
&nbsp;            // Imposta i parametri per il PreparedStatement
<b class="nc">&nbsp;            for (int i = 0; i &lt; params.size(); i++) {</b>
<b class="nc">&nbsp;                preparedStatement.setObject(i + 1, params.get(i));</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            ResultSet resultSet = preparedStatement.executeQuery();</b>
<b class="nc">&nbsp;            while (resultSet.next()) {</b>
<b class="nc">&nbsp;                Prodotto p = extractProductFromResultSet(resultSet);</b>
<b class="nc">&nbsp;                filteredProducts.add(p);</b>
&nbsp;            }
&nbsp;        } catch (SQLException e) {
<b class="nc">&nbsp;            throw new RuntimeException(e);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (sortingFilter != null){</b>
<b class="nc">&nbsp;            filterOnEvidence = sortingFilter.equals(&quot;evidence&quot;);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            filterOnEvidence = false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Fetch and set the cheapest variant for the products
<b class="nc">&nbsp;        filteredProducts.removeIf(prodotto -&gt; {</b>
<b class="nc">&nbsp;            Variante cheapestVariante = null;</b>
&nbsp;            try {
<b class="nc">&nbsp;                cheapestVariante = varianteDAO.doRetrieveCheapestFilteredVarianteByIdProdotto(</b>
<b class="nc">&nbsp;                        prodotto.getIdProdotto(), weightFilter, tasteFilter, filterOnEvidence);</b>
&nbsp;            } catch (SQLException e) {
<b class="nc">&nbsp;                throw new RuntimeException(e);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (cheapestVariante != null) {</b>
<b class="nc">&nbsp;                List&lt;Variante&gt; varianti = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                varianti.add(cheapestVariante);</b>
<b class="nc">&nbsp;                prodotto.setVarianti(varianti);</b>
<b class="nc">&nbsp;                return false; // Keep the product</b>
&nbsp;            }
<b class="nc">&nbsp;            return true; // Remove the product</b>
&nbsp;        });
&nbsp;
&nbsp;        // Handle sorting
<b class="nc">&nbsp;        if (sortingFilter != null &amp;&amp; !sortingFilter.isBlank()) {</b>
<b class="nc">&nbsp;            filteredProducts.sort(new Comparator&lt;Prodotto&gt;() {</b>
&nbsp;                public int compare(Prodotto p1, Prodotto p2) {
<b class="nc">&nbsp;                    return switch (sortingFilter) {</b>
<b class="nc">&nbsp;                        case &quot;PriceDesc&quot; -&gt; Float.compare(getLowestPrice(p2), getLowestPrice(p1));</b>
<b class="nc">&nbsp;                        case &quot;PriceAsc&quot; -&gt; Float.compare(getLowestPrice(p1), getLowestPrice(p2));</b>
<b class="nc">&nbsp;                        case &quot;CaloriesDesc&quot; -&gt; Integer.compare(p2.getCalorie(), p1.getCalorie());</b>
<b class="nc">&nbsp;                        case &quot;CaloriesAsc&quot; -&gt; Integer.compare(p1.getCalorie(), p2.getCalorie());</b>
<b class="nc">&nbsp;                        default -&gt; 0;</b>
&nbsp;                    };
&nbsp;                }
&nbsp;            });
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return filteredProducts;</b>
&nbsp;    }
&nbsp;
&nbsp;    private float getLowestPrice(Prodotto prodotto) {
<b class="nc">&nbsp;        List&lt;Variante&gt; varianti = prodotto.getVarianti();</b>
<b class="nc">&nbsp;        if (varianti == null || varianti.isEmpty()) {</b>
<b class="nc">&nbsp;            return Float.MAX_VALUE;</b>
&nbsp;        }
<b class="nc">&nbsp;        Variante variante = varianti.get(0);</b>
<b class="nc">&nbsp;        return variante.getPrezzo() * (1 - variante.getSconto() / 100.0f);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private Prodotto extractProductFromResultSet(ResultSet resultSet) throws SQLException {
<b class="nc">&nbsp;        Prodotto p = new Prodotto();</b>
<b class="nc">&nbsp;        p.setIdProdotto(resultSet.getString(&quot;id_prodotto&quot;));</b>
<b class="nc">&nbsp;        p.setNome(resultSet.getString(&quot;nome&quot;));</b>
<b class="nc">&nbsp;        p.setCategoria(resultSet.getString(&quot;categoria&quot;));</b>
<b class="nc">&nbsp;        p.setCalorie(resultSet.getInt(&quot;calorie&quot;));</b>
<b class="nc">&nbsp;        p.setImmagine(resultSet.getString(&quot;immagine&quot;));</b>
<b class="nc">&nbsp;        return p;</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;    public void doSave(Prodotto prodotto) {
<b class="nc">&nbsp;        try (Connection con = ConPool.getConnection()) {</b>
<b class="nc">&nbsp;            PreparedStatement ps = con.prepareStatement(</b>
&nbsp;                    &quot;INSERT INTO prodotto (id_prodotto, nome, descrizione, categoria, immagine, calorie, carboidrati, proteine, grassi) VALUES(?,?,?,?,?,?,?,?,?)&quot;,
&nbsp;                    Statement.RETURN_GENERATED_KEYS);
<b class="nc">&nbsp;            ps.setString(1,prodotto.getIdProdotto());</b>
<b class="nc">&nbsp;            ps.setString(2, prodotto.getNome());</b>
<b class="nc">&nbsp;            ps.setString(3, prodotto.getDescrizione());</b>
<b class="nc">&nbsp;            ps.setString(4, prodotto.getCategoria());</b>
<b class="nc">&nbsp;            ps.setString(5, prodotto.getImmagine());</b>
<b class="nc">&nbsp;            ps.setInt(6, prodotto.getCalorie());</b>
<b class="nc">&nbsp;            ps.setInt(7, prodotto.getCarboidrati());</b>
<b class="nc">&nbsp;            ps.setInt(8, prodotto.getProteine());</b>
<b class="nc">&nbsp;            ps.setInt(9, prodotto.getGrassi());</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;            if (ps.executeUpdate() != 1) {</b>
<b class="nc">&nbsp;                throw new RuntimeException(&quot;INSERT error.&quot;);</b>
&nbsp;            }
&nbsp;        } catch (SQLException e) {
<b class="nc">&nbsp;            throw new RuntimeException(e);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    public List&lt;Prodotto&gt; doRetrieveByCriteria(String attribute, String value){
<b class="nc">&nbsp;        if(Objects.equals(value, &quot;Tutto&quot;))</b>
<b class="nc">&nbsp;            doRetrieveAll();</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;        ArrayList&lt;Prodotto&gt; prodotti = new ArrayList&lt;&gt;();</b>
&nbsp;
&nbsp;        PreparedStatement preparedStatement;
&nbsp;        ResultSet resultSet;
&nbsp;
&nbsp;        Prodotto p;
&nbsp;
<b class="nc">&nbsp;        try (Connection connection = ConPool.getConnection()){</b>
&nbsp;
<b class="nc">&nbsp;            preparedStatement = connection.prepareStatement(&quot;SELECT * FROM prodotto where &quot; + attribute +&quot; = ?&quot;);</b>
<b class="nc">&nbsp;            preparedStatement.setString(1, value);</b>
<b class="nc">&nbsp;            resultSet = preparedStatement.executeQuery();</b>
&nbsp;
<b class="nc">&nbsp;            while (resultSet.next()){</b>
<b class="nc">&nbsp;                p = new Prodotto();</b>
<b class="nc">&nbsp;                p.setIdProdotto(resultSet.getString(&quot;id_prodotto&quot;));</b>
<b class="nc">&nbsp;                p.setNome(resultSet.getString(&quot;nome&quot;));</b>
<b class="nc">&nbsp;                p.setDescrizione(resultSet.getString(&quot;descrizione&quot;));</b>
<b class="nc">&nbsp;                p.setCategoria(resultSet.getString(&quot;categoria&quot;));</b>
<b class="nc">&nbsp;                p.setImmagine(resultSet.getString(&quot;immagine&quot;));</b>
<b class="nc">&nbsp;                p.setCalorie(resultSet.getInt(&quot;calorie&quot;));</b>
<b class="nc">&nbsp;                p.setCarboidrati(resultSet.getInt(&quot;carboidrati&quot;));</b>
<b class="nc">&nbsp;                p.setProteine(resultSet.getInt(&quot;proteine&quot;));</b>
<b class="nc">&nbsp;                p.setGrassi(resultSet.getInt(&quot;grassi&quot;));</b>
&nbsp;
&nbsp;
&nbsp;                /*
&nbsp;                VarianteDAO varianteDAO = new VarianteDAO();
&nbsp;                List&lt;Variante&gt; varianti = varianteDAO.doRetrieveVariantiByIdProdotto(p.getIdProdotto());
&nbsp;
&nbsp;                p.setVarianti(varianti);
&nbsp;                 */
<b class="nc">&nbsp;                VarianteDAO varianteDAO = new VarianteDAO();</b>
<b class="nc">&nbsp;                Variante cheapest = varianteDAO.doRetrieveCheapestVariant(p.getIdProdotto());</b>
<b class="nc">&nbsp;                List&lt;Variante&gt; varianti = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                varianti.add(cheapest);</b>
&nbsp;
<b class="nc">&nbsp;                p.setVarianti(varianti);</b>
&nbsp;
<b class="nc">&nbsp;                prodotti.add(p);</b>
&nbsp;
&nbsp;            }
&nbsp;            connection.close();
<b class="nc">&nbsp;            return prodotti;</b>
&nbsp;        } catch (SQLException e) {
<b class="nc">&nbsp;            throw new RuntimeException(e);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;    public List&lt;Prodotto&gt; doRetrieveAll() {
&nbsp;
<b class="nc">&nbsp;        ArrayList&lt;Prodotto&gt; prodotti = new ArrayList&lt;&gt;();</b>
&nbsp;        Statement st;
&nbsp;        ResultSet resultSet;
&nbsp;        Prodotto p;
&nbsp;
<b class="nc">&nbsp;        try (Connection con = ConPool.getConnection()) {</b>
&nbsp;
<b class="nc">&nbsp;            st = con.createStatement();</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;            String query = &quot;SELECT * FROM prodotto&quot;;</b>
&nbsp;
<b class="nc">&nbsp;            resultSet = st.executeQuery(query);</b>
&nbsp;
<b class="nc">&nbsp;            while(resultSet.next()) {</b>
<b class="nc">&nbsp;                p = new Prodotto();</b>
<b class="nc">&nbsp;                p.setIdProdotto(resultSet.getString(&quot;id_prodotto&quot;));</b>
<b class="nc">&nbsp;                p.setNome(resultSet.getString(&quot;nome&quot;));</b>
<b class="nc">&nbsp;                p.setDescrizione(resultSet.getString(&quot;descrizione&quot;));</b>
<b class="nc">&nbsp;                p.setCategoria(resultSet.getString(&quot;categoria&quot;));</b>
<b class="nc">&nbsp;                p.setImmagine(resultSet.getString(&quot;immagine&quot;));</b>
<b class="nc">&nbsp;                p.setCalorie(resultSet.getInt(&quot;calorie&quot;));</b>
<b class="nc">&nbsp;                p.setCarboidrati(resultSet.getInt(&quot;carboidrati&quot;));</b>
<b class="nc">&nbsp;                p.setProteine(resultSet.getInt(&quot;proteine&quot;));</b>
<b class="nc">&nbsp;                p.setGrassi(resultSet.getInt(&quot;grassi&quot;));</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;                VarianteDAO varianteDAO = new VarianteDAO();</b>
<b class="nc">&nbsp;                List&lt;Variante&gt; varianti = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                Variante variante = varianteDAO.doRetrieveCheapestVariant(p.getIdProdotto());</b>
<b class="nc">&nbsp;                varianti.add(variante);</b>
&nbsp;
<b class="nc">&nbsp;                p.setVarianti(varianti);</b>
&nbsp;
<b class="nc">&nbsp;                prodotti.add(p);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return prodotti;</b>
&nbsp;        } catch (SQLException e) {
<b class="nc">&nbsp;            throw new RuntimeException(e);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void updateProduct(Prodotto p, String idProdotto){
<b class="nc">&nbsp;        try (Connection connection = ConPool.getConnection()){</b>
<b class="nc">&nbsp;            PreparedStatement preparedStatement = connection.prepareStatement(&quot;update prodotto set id_prodotto = ?, nome = ?, descrizione = ?, categoria = ?, immagine = ?, calorie = ?, carboidrati = ?, proteine = ?, grassi = ? where id_prodotto = ?&quot;);</b>
<b class="nc">&nbsp;            preparedStatement.setString(1, p.getIdProdotto());</b>
<b class="nc">&nbsp;            preparedStatement.setString(2, p.getNome());</b>
<b class="nc">&nbsp;            preparedStatement.setString(3, p.getDescrizione());</b>
<b class="nc">&nbsp;            preparedStatement.setString(4, p.getCategoria());</b>
<b class="nc">&nbsp;            preparedStatement.setString(5, p.getImmagine());</b>
<b class="nc">&nbsp;            preparedStatement.setInt(6, p.getCalorie());</b>
<b class="nc">&nbsp;            preparedStatement.setInt(7, p.getCarboidrati());</b>
<b class="nc">&nbsp;            preparedStatement.setInt(8, p.getProteine());</b>
<b class="nc">&nbsp;            preparedStatement.setInt(9, p.getGrassi());</b>
<b class="nc">&nbsp;            preparedStatement.setString(10, idProdotto);</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;            int rowsUpdated = preparedStatement.executeUpdate();</b>
&nbsp;        }catch (SQLException e){
<b class="nc">&nbsp;            throw new RuntimeException(e);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    public void removeProductFromIdProdotto(String idProdotto){
<b class="nc">&nbsp;        try (Connection connection = ConPool.getConnection()){</b>
<b class="nc">&nbsp;            PreparedStatement preparedStatement = connection.prepareStatement(&quot;delete from prodotto where id_prodotto = ?&quot;);</b>
<b class="nc">&nbsp;            preparedStatement.setString(1, idProdotto);</b>
<b class="nc">&nbsp;            int rowsUpdated = preparedStatement.executeUpdate();</b>
&nbsp;
&nbsp;        }catch (SQLException e){
<b class="nc">&nbsp;            throw new RuntimeException(e);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-11-17 10:45</div>
</div>
</body>
</html>
